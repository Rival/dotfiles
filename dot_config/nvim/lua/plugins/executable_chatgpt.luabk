return -- Lazy
{
  "jackMort/ChatGPT.nvim",
  event = "VeryLazy",
  keys = {
    {
      "<leader>a<C-e>",
      mode = "v",
      function()
        require("chatgpt").edit_with_instructions()
      end,
      desc = "Edit with instructions",
    },
    {
      "<leader>ac",
      function()
        vim.api.nvim_command("ChatGPT")
      end,
      desc = "ChatGPT",
    },
    {
      "<leader>ar",
      function()
        vim.api.nvim_command("ChatGPTActAs")
      end,
      desc = "ChatGPT act as",
    },
    {
      "<leader>ax",
      function()
        vim.api.nvim_command("ChatGPTRun explain_code")
      end,
      mode = "v",
      desc = "ChatGPT explain",
    },
  },
  init = function()
    local config_path = vim.fn.stdpath("config")
    local file = io.open(config_path .. "/tools/chatgptapikey.txt", "r")
    if file then
      local key = file:read("*all"):gsub("%s+", "") -- Remove whitespace
      file:close()
      -- Set environment variable
      vim.env.OPENAI_API_KEY = key
      print("OpenApiKey" .. key)
    end
    local wk = require("which-key")
    wk.add({ "<leader>a", group = "AI", mode = { "n", "v" } })
  end,
  -- config = function()
  --   require("chatgpt").setup()
  -- end,
  config = function()
    local chatgpt = require("chatgpt")
    chatgpt.setup({
      openai_params = {
        -- NOTE: model can be a function returning the model name
        -- this is useful if you want to change the model on the fly
        -- using commands
        -- Example:
        model = "chatgpt-4o-latest",
        -- model = function()
        --     if some_condition() then
        --         return "gpt-4-1106-preview"
        --     else
        --         return "gpt-3.5-turbo"
        --     en       -- frequency_penalty = 0,
        -- presence_penalty = 0,
        -- max_tokens = 4095,
        -- temperature = 0.2,
        -- top_p = 0.1,
        -- n = 1,
      },
    })
  end,
  dependencies = {
    "MunifTanjim/nui.nvim",
    "nvim-lua/plenary.nvim",
    "folke/trouble.nvim", -- optional
    -- "nvim-telescope/telescope.nvim",
  },
}
